<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ethan Ding</title>
    <link rel="icon" type="image/png" href="/images/profile.png" />
    <link rel="stylesheet" crossorigin href="/assets/index-dwlculdd.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* Additional styles for the static version */
      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 3rem 1.5rem;
      }
      .header {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #eaeaea;
      }
      .profile-section {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
      }
      .profile-img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
      }
      h1 {
        font-size: 1.125rem;
        font-weight: 500;
      }
      h2 {
        font-size: 0.875rem;
        font-weight: normal;
        color: #666;
        margin: 0.25rem 0;
      }
      h2 a {
        color: #000;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
      }
      h2 a:hover {
        color: #666;
        text-decoration: underline;
      }
      .reading-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #eaeaea;
      }
      .writing-section {
        margin-bottom: 2rem;
      }
      .articles-container {
        margin-top: 1.5rem;
      }
      .articles-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .article-card {
        display: flex;
        padding: 1rem;
        border-bottom: 1px solid #f0f0f0;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s ease;
        margin: 0 -1rem;
      }
      .article-card:hover {
        background: #fafafa;
        transform: translateX(4px);
      }
      .article-card:last-of-type {
        border-bottom: none;
      }
      .article-content {
        flex: 1;
        min-width: 0;
      }
      .article-date {
        font-size: 0.75rem;
        color: #999;
        margin-bottom: 0.25rem;
      }
      .article-title {
        font-weight: 500;
        font-size: 0.95rem;
        margin-bottom: 0.5rem;
        line-height: 1.3;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }
      .article-excerpt {
        font-size: 0.813rem;
        color: #666;
        line-height: 1.4;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }
      .more-articles {
        text-align: center;
        margin-top: 1.5rem;
      }
      .more-articles a {
        color: #666;
        text-decoration: none;
        font-size: 0.875rem;
        transition: color 0.2s;
      }
      .more-articles a:hover {
        color: #000;
      }
      .view-all-link {
        color: #666;
        text-decoration: none;
        font-size: 0.875rem;
        transition: color 0.2s;
      }
      .view-all-link:hover {
        color: #000;
      }
      .reading-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }
      .reading-header h3 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
      }
      .reading-pace {
        font-size: 0.875rem;
        color: #666;
        margin-bottom: 1.5rem;
      }
      .books-container {
        margin-top: 1.5rem;
      }
      .reading-section-container {
        margin: 2rem 0;
      }
      .reading-chart {
        margin-bottom: 1.5rem;
      }
      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 1rem;
      }
      .chart-title {
        font-size: 0.875rem;
        font-weight: 500;
        color: #333;
      }
      .chart-container {
        position: relative;
        height: 180px;
        width: 100%;
      }
      .books-carousel {
        position: relative;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        padding: 0.5rem 0;
        margin: 0 -1.5rem;
      }
      .books-carousel::-webkit-scrollbar {
        height: 4px;
      }
      .books-carousel::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .books-carousel::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 2px;
      }
      .books-carousel::-webkit-scrollbar-thumb:hover {
        background: #999;
      }
      .carousel-content {
        display: flex;
        padding: 0 1.5rem;
        align-items: flex-start;
        min-height: 120px;
      }
      .month-section {
        position: relative;
        flex-shrink: 0;
        padding-right: 1rem;
        border-right: 1px solid #e5e5e5;
        margin-right: 1rem;
      }
      .month-section:last-child {
        border-right: none;
        margin-right: 0;
        padding-right: 0;
      }
      .month-header {
        position: absolute;
        top: 50%;
        right: -0.25rem;
        transform: translateY(-50%) translateX(100%) rotate(90deg);
        transform-origin: left center;
        font-size: 0.625rem;
        font-weight: 600;
        color: #aaa;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        background: #fff;
        padding: 0 0.25rem;
        white-space: nowrap;
        z-index: 1;
      }
      .month-books {
        display: flex;
        gap: 0.25rem;
      }
      .book-card {
        width: 70px;
        flex-shrink: 0;
        cursor: pointer;
        transition: transform 0.15s ease;
      }
      .book-card:hover {
        transform: translateY(-3px);
      }
      .book-cover {
        width: 100%;
        height: 100px;
        background: #f5f5f5;
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 0.3rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        border: 1px solid #f0f0f0;
      }
      .book-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
        will-change: transform;
      }
      .book-img {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }
      .book-img[src] {
        opacity: 1;
      }
      .book-title {
        font-weight: 500;
        font-size: 0.688rem;
        line-height: 1.1;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        padding: 0 0.25rem;
      }
      .book-author {
        display: none; /* Hide author to save space */
      }
      .loading {
        text-align: center;
        padding: 2rem;
        color: #666;
      }
      
      /* Skeleton loading styles */
      @keyframes shimmer {
        0% {
          background-position: -200px 0;
        }
        100% {
          background-position: calc(200px + 100%) 0;
        }
      }
      
      .skeleton {
        background: #eee;
        background-image: linear-gradient(
          90deg,
          #eee 0px,
          #f5f5f5 40px,
          #eee 80px
        );
        background-size: 200px 100%;
        animation: shimmer 1.5s infinite;
      }
      
      .skeleton-text {
        height: 0.875rem;
        border-radius: 4px;
        margin-bottom: 0.5rem;
      }
      
      .skeleton-text.title {
        height: 1rem;
        width: 80%;
      }
      
      .skeleton-text.line {
        height: 0.75rem;
        width: 100%;
      }
      
      .skeleton-text.short {
        width: 60%;
      }
      
      .skeleton-chart {
        height: 180px;
        border-radius: 4px;
        margin-bottom: 1.5rem;
      }
      
      .skeleton-books {
        display: flex;
        gap: 0.5rem;
        overflow: hidden;
        padding: 1rem 0;
      }
      
      .skeleton-book {
        width: 70px;
        flex-shrink: 0;
      }
      
      .skeleton-book-cover {
        width: 100%;
        height: 100px;
        border-radius: 2px;
        margin-bottom: 0.3rem;
      }
      
      .skeleton-article {
        display: flex;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid #f0f0f0;
      }
      
      .skeleton-article-image {
        width: 80px;
        height: 80px;
        border-radius: 4px;
        flex-shrink: 0;
      }
      .show-more-btn {
        margin: 2rem auto;
        display: block;
        padding: 0.75rem 2rem;
        background: #000;
        color: #fff;
        border: none;
        border-radius: 4px;
        font-size: 0.875rem;
        cursor: pointer;
        transition: opacity 0.2s;
      }
      .show-more-btn:hover {
        opacity: 0.8;
      }
      footer {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2rem;
        margin-top: 4rem;
      }
      .social-links {
        display: flex;
        gap: 1rem;
      }
      .social-link {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
        color: #000;
      }
      .social-link:hover {
        background: #e5e5e5;
      }
      .location-button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: none;
        border: none;
        padding: 0.5rem;
        color: #666;
        font-size: 0.875rem;
        cursor: pointer;
      }
      .location-button:hover {
        color: #000;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <div class="header">
        <div class="profile-section">
          <img src="/images/profile.png" alt="Ethan Ding" class="profile-img" />
          <h1>Ethan Ding</h1>
        </div>
        <h2>I am the Cofounder & CEO of <a href="https://textql.com/" target="_blank" rel="noopener noreferrer">TextQL</a></h2>
        <h2>Previously: <span><a href="https://bvp.com/" target="_blank" rel="noopener noreferrer">Bessemer</a>, </span><span><a href="https://tackle.io/" target="_blank" rel="noopener noreferrer">Tackle</a></span></h2>
        <h2><a href="https://mandate.beehiiv.com/p/the-next-trillion-dollar-company" target="_blank" rel="noopener noreferrer">Learn what I'm building</a></h2>
      </div>
      
      <section class="reading-section">
        <div class="reading-header">
          <h3>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z"/>
            </svg>
            Reading
          </h3>
        </div>
        <div class="reading-section-container">
          <div class="reading-chart">
            <div class="chart-header">
              <h4 class="chart-title">Reading Activity</h4>
              <p class="reading-pace">Current pace: <span id="book-count">58</span> books in the past 365 days</p>
            </div>
            <div class="chart-container">
              <canvas id="readingChart"></canvas>
            </div>
          </div>
          <div id="books-list">
            <div class="skeleton-books">
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
              <div class="skeleton-book"><div class="skeleton skeleton-book-cover"></div></div>
            </div>
          </div>
        </div>
      </section>
      
      <section class="writing-section">
        <div class="reading-header">
          <h3>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
            Writing
          </h3>
          <a href="https://ethanding.substack.com" target="_blank" rel="noopener noreferrer" class="view-all-link">View all articles →</a>
        </div>
        <div id="articles-list">
          <div class="skeleton-article">
            <div class="skeleton skeleton-article-image"></div>
            <div style="flex: 1;">
              <div class="skeleton skeleton-text short"></div>
              <div class="skeleton skeleton-text title"></div>
              <div class="skeleton skeleton-text line"></div>
              <div class="skeleton skeleton-text line short"></div>
            </div>
          </div>
          <div class="skeleton-article">
            <div class="skeleton skeleton-article-image"></div>
            <div style="flex: 1;">
              <div class="skeleton skeleton-text short"></div>
              <div class="skeleton skeleton-text title"></div>
              <div class="skeleton skeleton-text line"></div>
              <div class="skeleton skeleton-text line short"></div>
            </div>
          </div>
          <div class="skeleton-article">
            <div class="skeleton skeleton-article-image"></div>
            <div style="flex: 1;">
              <div class="skeleton skeleton-text short"></div>
              <div class="skeleton skeleton-text title"></div>
              <div class="skeleton skeleton-text line"></div>
              <div class="skeleton skeleton-text line short"></div>
            </div>
          </div>
        </div>
      </section>
      
      <footer>
        <div class="social-links">
          <a href="https://twitter.com/theethanding" target="_blank" rel="noopener noreferrer" aria-label="Twitter" class="social-link">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path fill="currentColor" d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path>
            </svg>
          </a>
          <a href="mailto:ethan@textql.com" target="_blank" rel="noopener noreferrer" aria-label="Email" class="social-link">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path fill="currentColor" d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z"></path>
              <path fill="currentColor" d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z"></path>
            </svg>
          </a>
          <a href="https://linkedin.com/in/theethanding" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="social-link">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path fill="currentColor" d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"></path>
            </svg>
          </a>
        </div>
        <button class="location-button">
          <svg viewBox="0 0 14 14" fill="currentColor" width="14" height="14">
            <path d="M7 0C4.1 0 1.8 2.3 1.8 5.2c0 3.9 5.2 8.8 5.2 8.8s5.2-4.9 5.2-8.8C12.2 2.3 9.9 0 7 0zm0 7.8c-1.4 0-2.6-1.2-2.6-2.6S5.6 2.6 7 2.6s2.6 1.2 2.6 2.6S8.4 7.8 7 7.8z"></path>
          </svg>
          Made in New York
        </button>
      </footer>
    </main>
    <script>
      let allBooks = [];
      let displayCount = 10;
      let chartInstance = null;
      
      // Fetch all books from Airtable API and display them
      async function fetchAndDisplayBooks() {
        try {
          const baseId = 'appp0rlDg8bs8FlVB';
          const tableId = 'tblLzVsk6YxiQ0xxE';
          const viewId = 'viw7ZSeTTduvLSsKX';
          const token = 'pat7ufqR4W0PzZw7m.3743b667a61b9956e108549aa613b4e23af8b95a718e016e77bde446cb2291c3';
          
          let offset = null;
          
          // Fetch all pages of records
          do {
            const url = offset 
              ? `https://api.airtable.com/v0/${baseId}/${tableId}?view=${viewId}&offset=${offset}`
              : `https://api.airtable.com/v0/${baseId}/${tableId}?view=${viewId}`;
              
            const response = await fetch(url, {
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });
            
            if (response.ok) {
              const data = await response.json();
              allBooks = allBooks.concat(data.records);
              offset = data.offset;
            } else {
              throw new Error('Failed to fetch books');
            }
          } while (offset);
          
          // Calculate books read in past 365 days
          const today = new Date();
          const oneYearAgo = new Date(today);
          oneYearAgo.setDate(oneYearAgo.getDate() - 365);
          
          const booksLastYear = allBooks.filter(record => {
            const dateFinished = record.fields['Date Finished'];
            if (dateFinished) {
              const finishDate = new Date(dateFinished);
              return finishDate >= oneYearAgo && finishDate <= today;
            }
            return false;
          });
          
          // Update book count with rolling 365-day count
          document.getElementById('book-count').textContent = booksLastYear.length;
          
          // Create reading chart
          createReadingChart();
          
          // Display books
          displayBooks();
          
        } catch (error) {
          console.error('Error fetching books:', error);
          document.getElementById('books-list').innerHTML = 
            '<p>Unable to load books. <a href="https://airtable.com/embed/shrvFfepLidSzTkeI?backgroundColor=cyan&layout=card&viewControls=on" target="_blank">View on Airtable</a></p>';
        }
      }
      
      function displayBooks() {
        const booksContainer = document.getElementById('books-list');
        
        if (allBooks.length === 0) {
          booksContainer.innerHTML = '<p>No books found.</p>';
          return;
        }
        
        // Group books by month
        const booksByMonth = {};
        allBooks.forEach((record, index) => {
          const dateFinished = record.fields['Date Finished'];
          if (dateFinished) {
            const date = new Date(dateFinished);
            const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            if (!booksByMonth[monthKey]) {
              booksByMonth[monthKey] = [];
            }
            record.index = index; // Store index for scrolling
            booksByMonth[monthKey].push(record);
          }
        });
        
        // Sort months chronologically
        const sortedMonths = Object.keys(booksByMonth).sort();
        
        // Create carousel HTML
        let carouselHTML = '<div class="books-carousel" id="booksCarousel"><div class="carousel-content">';
        
        sortedMonths.forEach(monthKey => {
          const [year, month] = monthKey.split('-');
          const date = new Date(year, month - 1);
          const monthName = date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
          
          carouselHTML += `<div class="month-section" data-month="${monthKey}">
            <div class="month-header">${monthName}</div>
            <div class="month-books">`;
          
          booksByMonth[monthKey].forEach(record => {
            const fields = record.fields;
            const title = fields.Book ? fields.Book.trim() : 'Untitled';
            const authors = fields.Author ? fields.Author.join(', ') : 'Unknown Author';
            
            // Get cover image if available - use small thumbnail for faster loading
            let coverUrl = '';
            let fullCoverUrl = '';
            if (fields.cover && fields.cover.length > 0) {
              // Use small thumbnail initially, upgrade to large on hover/view
              coverUrl = fields.cover[0].thumbnails?.small?.url || fields.cover[0].thumbnails?.large?.url || fields.cover[0].url;
              fullCoverUrl = fields.cover[0].thumbnails?.large?.url || fields.cover[0].url;
            }
            
            carouselHTML += `
              <div class="book-card" data-index="${record.index}">
                <div class="book-cover" ${fullCoverUrl ? `data-full-src="${escapeHtml(fullCoverUrl)}"` : ''}>
                  ${coverUrl ? `<img class="book-img" src="${escapeHtml(coverUrl)}" alt="${escapeHtml(title)}" loading="lazy" decoding="async">` : ''}
                </div>
                <div class="book-title">${escapeHtml(title)}</div>
                <div class="book-author">${escapeHtml(authors)}</div>
              </div>
            `;
          });
          
          carouselHTML += '</div></div>';
        });
        
        carouselHTML += '</div></div>';
        booksContainer.innerHTML = carouselHTML;
        
        // Store month positions for chart interaction
        window.monthPositions = {};
        document.querySelectorAll('.month-section').forEach(section => {
          const monthKey = section.getAttribute('data-month');
          window.monthPositions[monthKey] = section.offsetLeft;
        });
        
        // Set up lazy loading with Intersection Observer
        setupLazyLoading();
        
        // Upgrade visible images to high quality
        upgradeVisibleImages();
      }
      
      function setupLazyLoading() {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const bookCover = entry.target;
              const img = bookCover.querySelector('img');
              const fullSrc = bookCover.getAttribute('data-full-src');
              
              if (img && fullSrc && !img.hasAttribute('data-upgraded')) {
                // Create new image to preload
                const newImg = new Image();
                newImg.onload = function() {
                  img.src = fullSrc;
                  img.setAttribute('data-upgraded', 'true');
                };
                newImg.src = fullSrc;
              }
              
              observer.unobserve(bookCover);
            }
          });
        }, {
          rootMargin: '50px'
        });
        
        // Observe all book covers
        document.querySelectorAll('.book-cover[data-full-src]').forEach(cover => {
          imageObserver.observe(cover);
        });
      }
      
      function upgradeVisibleImages() {
        // Immediately upgrade images that are already visible
        const carousel = document.getElementById('booksCarousel');
        if (!carousel) return;
        
        const visibleCovers = carousel.querySelectorAll('.book-cover[data-full-src]');
        visibleCovers.forEach(cover => {
          const rect = cover.getBoundingClientRect();
          if (rect.left < window.innerWidth && rect.right > 0) {
            const img = cover.querySelector('img');
            const fullSrc = cover.getAttribute('data-full-src');
            if (img && fullSrc && !img.hasAttribute('data-upgraded')) {
              const newImg = new Image();
              newImg.onload = function() {
                img.src = fullSrc;
                img.setAttribute('data-upgraded', 'true');
              };
              newImg.src = fullSrc;
            }
          }
        });
      }
      
      function showMoreBooks() {
        displayCount = Math.min(displayCount + 10, allBooks.length);
        displayBooks();
      }
      
      function createReadingChart() {
        // Process books data for the chart
        const monthlyData = {};
        
        // Find date range from all books
        let earliestDate = null;
        let latestDate = null;
        
        allBooks.forEach(record => {
          const dateFinished = record.fields['Date Finished'];
          if (dateFinished) {
            const date = new Date(dateFinished);
            if (!earliestDate || date < earliestDate) earliestDate = date;
            if (!latestDate || date > latestDate) latestDate = date;
          }
        });
        
        if (!earliestDate || !latestDate) return;
        
        // Initialize all months in the range
        const currentDate = new Date(earliestDate);
        while (currentDate <= latestDate) {
          const key = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
          monthlyData[key] = 0;
          currentDate.setMonth(currentDate.getMonth() + 1);
        }
        
        // Count books per month
        allBooks.forEach(record => {
          const dateFinished = record.fields['Date Finished'];
          if (dateFinished) {
            const date = new Date(dateFinished);
            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            if (monthlyData.hasOwnProperty(key)) {
              monthlyData[key]++;
            }
          }
        });
        
        const labels = Object.keys(monthlyData).map(key => {
          const [year, month] = key.split('-');
          const date = new Date(year, month - 1);
          return date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
        });
        
        const data = Object.values(monthlyData);
        
        // Destroy existing chart if it exists
        if (chartInstance) {
          chartInstance.destroy();
        }
        
        // Custom plugin for vertical line on hover
        const verticalLinePlugin = {
          id: 'verticalLine',
          afterDatasetsDraw: function(chart, args, options) {
            const { ctx } = chart;
            const mousePosition = chart._active?.length ? chart._active[0].element.x : chart._lastEvent?.x;
            
            if (mousePosition && chart._lastEvent && chart._lastEvent.type === 'mousemove') {
              const x = chart._lastEvent.x;
              const topY = chart.scales.y.top;
              const bottomY = chart.scales.y.bottom;
              
              // Check if mouse is within chart area
              if (x >= chart.scales.x.left && x <= chart.scales.x.right) {
                ctx.save();
                ctx.beginPath();
                ctx.moveTo(x, topY);
                ctx.lineTo(x, bottomY);
                ctx.lineWidth = 1;
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.15)';
                ctx.setLineDash([3, 3]);
                ctx.stroke();
                ctx.restore();
              }
            }
          },
          afterEvent: function(chart, args) {
            chart._lastEvent = args.event;
            chart.render();
          }
        };
        
        // Create chart
        const ctx = document.getElementById('readingChart').getContext('2d');
        chartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Books Read',
              data: data,
              backgroundColor: 'rgba(0, 0, 0, 0.05)',
              borderColor: 'rgba(0, 0, 0, 0.8)',
              borderWidth: 2,
              pointRadius: 3,
              pointBackgroundColor: 'rgba(0, 0, 0, 0.8)',
              pointBorderColor: 'rgba(0, 0, 0, 0.8)',
              pointHoverRadius: 5,
              tension: 0.2,
              fill: true
            }]
          },
          plugins: [verticalLinePlugin],
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: 'index'
            },
            onHover: (event, activeElements) => {
              event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 8,
                cornerRadius: 4,
                displayColors: false,
                callbacks: {
                  label: function(context) {
                    return context.parsed.y + ' books';
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 1,
                  font: {
                    size: 11
                  }
                },
                grid: {
                  drawBorder: false,
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                ticks: {
                  font: {
                    size: 11
                  }
                },
                grid: {
                  display: false,
                  drawBorder: false
                }
              }
            },
            onHover: (event, activeElements) => {
              if (activeElements.length > 0) {
                const index = activeElements[0].index;
                const monthKey = Object.keys(monthlyData)[index];
                const carousel = document.getElementById('booksCarousel');
                if (carousel && window.monthPositions && window.monthPositions[monthKey]) {
                  carousel.scrollLeft = window.monthPositions[monthKey];
                }
              }
            }
          }
        });
      }
      
      // Helper function to format dates
      function formatDate(dateStr) {
        const date = new Date(dateStr);
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
      }
      
      // Helper function to escape HTML
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      // Helper function to decode HTML entities
      function decodeHtmlEntities(text) {
        const textArea = document.createElement('textarea');
        textArea.innerHTML = text;
        return textArea.value;
      }
      
      // Fetch books when page loads
      fetchAndDisplayBooks();
      
      // Fetch articles from Substack
      async function fetchAndDisplayArticles() {
        try {
          // Using RSS2JSON service to bypass CORS
          const rssUrl = 'https://ethanding.substack.com/feed';
          const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
          
          const response = await fetch(apiUrl);
          if (!response.ok) throw new Error('Failed to fetch articles');
          
          const data = await response.json();
          const articles = data.items || [];
          
          displayArticles(articles.slice(0, 3)); // Show latest 3 articles
        } catch (error) {
          console.error('Error fetching articles:', error);
          document.getElementById('articles-list').innerHTML = 
            '<p>Unable to load articles. <a href="https://ethanding.substack.com" target="_blank">Visit Substack</a></p>';
        }
      }
      
      function displayArticles(articles) {
        const articlesContainer = document.getElementById('articles-list');
        
        if (articles.length === 0) {
          articlesContainer.innerHTML = '<p>No articles found.</p>';
          return;
        }
        
        const articlesHTML = articles.map(article => {
          const date = new Date(article.pubDate);
          const formattedDate = date.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric', 
            year: 'numeric' 
          });
          
          // Strip HTML from description to get plain text excerpt
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = article.description || '';
          let excerpt = tempDiv.textContent || tempDiv.innerText || '';
          
          // Decode HTML entities
          const textArea = document.createElement('textarea');
          textArea.innerHTML = excerpt;
          excerpt = textArea.value;
          
          return `
            <a href="${escapeHtml(article.link)}" target="_blank" rel="noopener noreferrer" class="article-card">
              <div class="article-content">
                <div class="article-date">${escapeHtml(formattedDate)}</div>
                <div class="article-title">${escapeHtml(decodeHtmlEntities(article.title))}</div>
                <div class="article-excerpt">${escapeHtml(excerpt.substring(0, 150))}...</div>
              </div>
            </a>
          `;
        }).join('');
        
        articlesContainer.innerHTML = `
          <div class="articles-container">
            <div class="articles-list">
              ${articlesHTML}
            </div>
          </div>
        `;
      }
      
      // Fetch articles when page loads
      fetchAndDisplayArticles();
    </script>
  </body>
</html>